using ABI.CCK.Components;
using CVRX.UIs;
using MelonLoader;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using UnityEngine;

namespace CVRX.Mods.Exploits
{
    internal class BeyBladePickup
    {
        public static List<CVRPickupObject> items = new List<CVRPickupObject>();
        public static bool isPickupSpinning = false;
        public static bool expanded = false;
        public static bool tempval = false;

        public static void Render()
        {
            UIEx.Collapsible("BeyBladePickup", () =>
            {
                tempval = UIEx.Checkbox(tempval, tempval ? "Enabled" : "Disabled", (newState) =>
                {
                    State(!tempval);
                });
            });
        }

        public static void State(bool s)
        {
            if (s)
            {
                items = Resources.FindObjectsOfTypeAll<CVRPickupObject>().Where(i => i != null && !i.name.ToLower().Contains("quickmenu")).ToList();
                if (items.Count == 0)
                {
                    XConsole.Log("Client", "ItemOrbit: No valid items found.");
                    return;
                }
                isPickupSpinning = true;
                MelonCoroutines.Start(BeyBladePickups());
            }
            else
            {
                isPickupSpinning = false;
                items.Clear();
            }
        }
        public static IEnumerator BeyBladePickups()
        {
            float rotationSpeed = 1000f;

            while (isPickupSpinning)
            {
                foreach (CVRPickupObject pickup in items)
                {
                    if (pickup != null)
                    {
                        pickup.transform.Rotate(rotationSpeed * Time.deltaTime, 0f, 0f);
                    }
                }
                yield return null;
            }
        }
    }
}
