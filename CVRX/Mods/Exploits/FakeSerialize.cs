using CVRX.Mods.Movements;
using CVRX.UIs;
using CVRX.Wrappers;
using UnityEngine;

namespace CVRX.Mods.Exploits
{
    internal class FakeSerialize
    {
        public static GameObject SerializeSphere;
        public static bool NoSerialize = false;

        public static void Render()
        {
            UIEx.Collapsible("NoSerialize", () =>
            {
                NoSerialize = UIEx.Checkbox(NoSerialize, NoSerialize ? "Enabled" : "Disabled", (newState) =>
                {
                    NoSerialize = newState;
                    ToggleSerialize(newState);
                });
            });
        }

        public static void CreateSphere()
        {
            SerializeSphere = GameObject.CreatePrimitive(PrimitiveType.Capsule);
            SerializeSphere.name = "Serialize Sphere";
            Vector3 playerPos = PlayerWrappers.GetLocalPlayer().transform.position;
            SerializeSphere.transform.position = playerPos + new Vector3(0, 0.5f, 0);
            SerializeSphere.transform.rotation = PlayerWrappers.GetLocalPlayer().transform.rotation;
            SerializeSphere.transform.localScale = Vector3.one * 0.5f;
            SerializeSphere.GetComponent<CapsuleCollider>().enabled = false;
            var renderer = SerializeSphere.GetComponent<Renderer>();
            if (renderer != null)
            {
                renderer.material = new Material(Shader.Find("GUI/Text Shader"));
                renderer.material.color = new Color(1, 0, 0.8679245f, 0.2150943f);
            }
        }

        public static void DeleteSphere()
        {
            if (SerializeSphere != null) GameObject.Destroy(SerializeSphere);
        }

        public static void ToggleSerialize(bool state)
        {
            NoSerialize = state;
            if (ConfManager.Ex_Serialize_RestorePos)
            {
                PosSaver.State(state);
            }
            if (NoSerialize) CreateSphere();
            else DeleteSphere();
        }
    }
}
